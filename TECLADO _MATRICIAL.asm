;TECLADO MATRICIAL

.INCLUDE "m16def.inc"
.ORG 0

LDI R16 HIGH(RAMEND)
OUT SPH,R16
LDI R16,LOW(RAMEND)
OUT SPL,R16

LDI R16 0x0F
OUT DDRC,R16

CALL TECLADO

TECLADO:
LDI R17,4
LDI R18,0XFE
LDI R19,3

otrafila:
OUT PORTC,R18
NOP
IN R16,PINC
ANDI R16,0XF0
CPI R16,0XF0
BRNE tecla_pres
SEC
ROL R18
SUBI R19,-4
DEC R17
BRNE otrafila
LDI R19,0XFF
RET

tecla_press:
CALL delay10ms
IN R16,PINC
ANDI R16,0XF0
CPI R16,0XF0
BRNE tecla
LDI R19,0XFF
RET

tecla:

ROL R19
BRCC soltar
DEC R19
RJMP tecla

soltar:
IN R16,PINC
ANDI R16,0XF0
CPI R16,0XF0
BRNE soltar
CALL delay10ms
RET

