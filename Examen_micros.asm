.ORG 0
.INCLUDE "m16def.inc"
LDI R16,HIGH(RAMEND)
OUT SPH,R16
LDI R16,LOW(RAMEND)
OUT SPL,R16

;LLANTA DERECHA
SBI DDRD,0;AVANZA
SBI DDRD,1;RETROCEDE

;LLANTA IZQUIERDA
SBI DDRD,2;AVANZA
SBI DDRD,3;RETROCEDE

CBI DDRD,5; Interruptor ON/OF

;Preparar PUNTERO
LDI ZH,HIGH(DATOS<<1)
LDI ZL,LOW(DATOS<<1)
LPM R19,Z+;8
LPM R20,Z+;0
LPM R20,Z+;8
LPM R21,Z+;0
LPM R21,Z;8


;PRIMER CONDICION, REVISAR EL ESTADO DEL INTERRUPTOR
HERE:
SBIC PIND,5
CALL ENCENDIDO
RJMP HERE

ENCENDIDO:
CALL delay100ms
IN R16,PINA
IN R17,PINB
IN R18,PINB

;SENSOR A GIRAR DERECHA
SENSORA:
CPI R16,0xFF; 
BRSH SENSORB
CP R16,R18
BRLO GIRARA

;SENSOR B RETROCEDER
SENSORB:
CPI R17,0xFF;
BRSH SENSORC
CP R17,R19
BRLO REVERSAB

;SENSOR C GIRAR IZQUIERDA
SENSORC:
CPI R18,0xFF;
BRSH AVANZAR
CP R18,R20
BRLO GIRARC
RJMP AVANZAR
;MOVIMIENTOS
GIRARA:
CBI PORTD,0
CBI PORTD,1
SBI PORTD,2
CBI PORTD,3
RJMP SENSORB

REVERSAB:
CBI PORTD,0
SBI PORTD,1
CBI PORTD,2
SBI PORTD,3
RJMP SENSORC

GIRARC:
SBI PORTD,0
CBI PORTD,1
CBI PORTD,2
CBI PORTD,3
RJMP AVANZAR

AVANZAR:
SBI PORTD,0
CBI PORTD,1
SBI PORTD,2
CBI PORTD,3
RET

delay10ms:
	LDI R26, 104
	ciclo2:
		LDI R27, 255
		ciclo1:
			DEC R27
			BRNE ciclo1
		DEC R26
		BRNE ciclo2
	RET

delay100ms:
	LDI R28, 10
	ciclo3:
		CALL delay10ms
		DEC R28
		BRNE ciclo3
	RET

.ORG $400
DATOS:
.DB 10,0,10,0,10,0