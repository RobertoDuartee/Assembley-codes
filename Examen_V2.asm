
;COMPILADOR Y PUNTERO A LA PILA
.ORG 0
.INCLUDE "m16def.inc"

LDI R16,HIGH(RAMEND)
OUT SPH,R16
LDI R16,LOW(RAMEND)
OUT SPL,R16

;NOMBRES REGISTROS
.DEF SENSORA=R16
.DEF SENSORB=R17
.DEF SENSORC=R18
.DEF PARAMETROA=R19
.DEF PARAMETROB=R20
.DEF PARAMETROC=R21

;LLANTA DERECHA SALIDA
SBI DDRD,0	;AVANZA
SBI DDRD,1	;RETROCEDE

;LLANTA IZQUIERDA SALIDA
SBI DDRD,2	;AVANZA
SBI DDRD,3	;RETROCEDE

CBI DDRD,5	;Interruptor ON/OF

;PUNTERO A FLASH
LDI ZH,HIGH(DATOS<<1)
LDI ZL,LOW(DATOS<<1)
LPM PARAMETROA,Z+	;10
LPM PARAMETROB,Z+	;0
LPM PARAMETROB,Z+	;10
LPM PARAMETROC,Z+	;0
LPM PARAMETROC,Z	;10


;PRIMER CONDICION, REVISAR EL ESTADO DEL INTERRUPTOR
SWITCH:
	SBIC PIND,5
	RJMP SWITCH


CALL delay100ms
IN SENSORA,PINA
IN SENSORB,PINB
IN SENSORC,PINC

;SENSOR B - RETROCEDER
LECTURAB:
	CPI SENSORB,0xFF
	BREQ LECTURAA
	CP SENSORB,PARAMETROB
	BRLO REVERSA

;SENSOR A - GIRAR DERECHA
LECTURAA:
	CPI SENSORA,0xFF 
	BREQ LECTURAC
	CP SENSORA,PARAMETROA
	BRLO GIRARDER

;SENSOR C - GIRAR IZQUIERDA
LECTURAC:
	CPI SENSORC,0xFF
	BREQ AVANZAR
	CP SENSORC,PARAMETROC
	BRLO GIRARIZQ

;SI NO DETECTA NADA, SIGUE AVANZANDO
AVANZAR:
	SBI PORTD,0
	CBI PORTD,1
	SBI PORTD,2
	CBI PORTD,3
	RJMP SWITCH

;MOVIMIENTOS
GIRARDER:
	CBI PORTD,0
	CBI PORTD,1
	SBI PORTD,2
	CBI PORTD,3
	RJMP SWITCH

REVERSA:
	CBI PORTD,0
	SBI PORTD,1
	CBI PORTD,2
	SBI PORTD,3
	RJMP SWITCH

GIRARIZQ:
	SBI PORTD,0
	CBI PORTD,1
	CBI PORTD,2
	CBI PORTD,3
	RJMP SWITCH

;DELAYS
delay10ms:
	LDI R26, 104
	ciclo2:
		LDI R27, 255
		ciclo1:
			DEC R27
			BRNE ciclo1
		DEC R26
		BRNE ciclo2
	RET

delay100ms:
	LDI R28, 10
	ciclo3:
		CALL delay10ms
		DEC R28
		BRNE ciclo3
	RET

.ORG $400
DATOS:
.DB 10,0,10,0,10,0